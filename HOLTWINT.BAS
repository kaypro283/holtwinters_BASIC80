10 REM HOLT-WINTERS FORECASTING PROGRAM BY C. VAN DER KAAY (2024)
20 CLEAR
30 PRINT  " WELCOME TO THE HOLT-WINTERS FORECASTING PROGRAM"
40 PRINT  "------------------------------------------------------------"
50 PRINT  " THIS PROGRAM UTILIZES THE ADVANCED HOLT-WINTERS METHOD FOR"
60 PRINT  " TIME SERIES FORECASTING. IT EFFECTIVELY ESTIMATES LEVEL, TREND,"
70 PRINT  " AND SEASONAL COMPONENTS USING OPTIMIZED SMOOTHING FACTORS:"
80 PRINT  " ALPHA, BETA, AND GAMMA. IDEAL FOR DATA WITH TRENDS AND SEASONALITY,"
90 PRINT  " THIS PROGRAM PROVIDES ACCURATE FUTURE VALUES AND COMPUTES KEY"
100 PRINT  " ERROR METRICS SUCH AS MPE, MAPE, RMSE, MAE, DURBIN-WATSON"
110 PRINT  " STATISTIC, AND THE LJUNG-BOX Q TEST."
120 PRINT  "------------------------------------------------------------"
130 PRINT  " PROGRAM AUTOMATICALLY CALCULATES THE SEASONAL PERIOD BY"
140 PRINT  " ANALYZING THE PERIODICITY IN THE HISTORICAL DATA SERIES USING"
150 PRINT  " THE AUTOCORRELATION FUNCTION (ACF)."
160 PRINT  "------------------------------------------------------------"
170 PAUSED = 0
180 PRINT 
190 PRINT "PRESS ENTER TO START OR TYPE 'INFO' FOR DETAILS"
200 PRINT "OR TYPE 'DEBUG' TO ENABLE DEBUG MODE FOR AUTOMATIC TESTING"
210 INPUT BEGIN$
220 IF BEGIN$ = "INFO" THEN GOSUB 4680 : PRINT : PRINT "RETURNING FROM INFO MENU..." : GOTO 190
230 IF BEGIN$ = "DEBUG" THEN DEBUGMODE = 1 : GOTO 260
240 IF BEGIN$ = "" THEN GOTO 260
250 PRINT "INVALID INPUT. PLEASE PRESS ENTER, OR TYPE 'INFO' OR 'DEBUG'." : GOTO 190
260 IF DEBUGMODE = 1 THEN GOSUB 5700 : GOTO 560
270 PRINT "IS YOUR DATA SEASONALITY ADDITIVE OR MULTIPLICATIVE? (A/M)"
280 INPUT SEASONALITY$
290 IF SEASONALITY$ = "A" THEN MODELTYPE = 1 : GOTO 320
300 IF SEASONALITY$ = "M" THEN MODELTYPE = 2 : GOTO 320
310 PRINT "INVALID INPUT. ENTER 'A' FOR ADDITIVE OR 'M' FOR MULTIPLICATIVE." : GOTO 270
320 DIM Y(400), F(400), S(400), T(400), C(400), U(400), L(400), E(400), ACFY(200), ACFRES(200)
330 INPUT "ENTER NUMBER OF HISTORICAL DATA POINTS: "; N$
340 N = VAL(N$)
350 IF N <= 0 OR N <> INT(N) THEN PRINT "INVALID INPUT. PLEASE ENTER A POSITIVE INTEGER." : GOTO 330
370 FOR I = 1 TO N
380 INPUT "ENTER DATA POINT "; Y$
390 IF Y$ = "" THEN PRINT "INPUT CANNOT BE EMPTY." : I = I - 1 : GOTO 380
400 FOR J = 1 TO LEN(Y$)
410 C$ = MID$(Y$, J, 1)
420 IF (C$ < "0" OR C$ > "9") AND C$ <> "." AND C$ <> "-" THEN PRINT "INVALID INPUT. PLEASE ENTER A VALID NUMBER." : I = I - 1 : GOTO 380
430 NEXT J
440 Y(I) = VAL(Y$)
450 PRINT "YOU ENTERED: "; Y(I)
460 INPUT "IS THIS CORRECT? (Y/N): "; CORRECT$
470 IF CORRECT$ = "N" THEN PRINT "PLEASE RE-ENTER THE CORRECT VALUE." : I = I - 1
480 NEXT I
490 INPUT "ENTER FORECAST HORIZON (1-100): "; H$
500 H = VAL(H$)
510 IF H <= 0 OR H > 100 OR H <> INT(H) THEN PRINT "INVALID INPUT. PLEASE ENTER A NUMBER BETWEEN 1 AND 100." : GOTO 490
540 TRAINSIZE = N - H
550 IF TRAINSIZE < 2 THEN PRINT "ERROR: NOT ENOUGH DATA FOR TRAINING. REDUCE FORECAST HORIZON." : END
560 REM CALCULATE SEASONAL PERIOD AUTOMATICALLY
570 GOSUB 3760 ' CALCULATE ACF AND DETERMINE P
580 IF P <= 0 OR P <> INT(P) THEN PRINT "WARNING: SEASONAL PERIOD NOT DETECTED. USING DEFAULT P = 12" : P = 12
590 IF 2 * P > 200 THEN PRINT "ERROR: SEASONAL PERIOD TOO LARGE.": END
600 PRINT:PRINT "----------------------------------"
610 PRINT "DETECTED SEASONAL PERIOD: "; P
620 IF TRAINSIZE < 2 * P THEN PRINT "WARNING: TOO FEW FULL SEASONS FOR RELIABLE SEASONALITY" : REM CONTINUE ANYWAY
630 PRINT "----------------------------------"
640 PRINT:PRINT "YOU HAVE SUCCESSFULLY ENTERED THE REQUIRED DATA."
650 PRINT "THE PROGRAM WILL NOW BEGIN TESTING SMOOTHING FACTORS."
660 PRINT "DO YOU WANT FAST MODE (80 COMBINATIONS) OR FULL MODE (810 COMBINATIONS)?"
670 PRINT "TYPE 'F' FOR FAST OR 'FULL' FOR COMPLETE SEARCH:"
680 INPUT MODE$
690 IF MODE$ = "F" THEN FASTMODE = 1 : GOTO 720
700 IF MODE$ = "FULL" THEN FASTMODE = 0 : GOTO 720
710 PRINT "INVALID INPUT. TYPE 'F' FOR FAST OR 'FULL' FOR COMPLETE SEARCH." : GOTO 680
720 REM OPTIMIZE SMOOTHING FACTORS
730 BESTMSE = 1E+30
740 REM -- PROGRESS TRACKING VARIABLES --
750 COMBOCOUNT = 0
760 IF FASTMODE = 1 THEN TOTALCOMBOS = 80 ELSE TOTALCOMBOS = 810
770 IF FASTMODE = 1 THEN AISTART = 2 : AISTEP = 2 : AIEND = 8 ELSE AISTART = 1 : AISTEP = 1 : AIEND = 9
780 FOR AI = AISTART TO AIEND STEP AISTEP
790 ALPHA = AI / 10
800 IF FASTMODE = 1 THEN BISTART = 2 : BISTEP = 2 : BIEND = 8 ELSE BISTART = 1 : BISTEP = 1 : BIEND = 9
810 FOR BI = BISTART TO BIEND STEP BISTEP
820 BETA = BI / 10
830 IF FASTMODE = 1 THEN GISTART = 2 : GISTEP = 2 : GIEND = 10 ELSE GISTART = 1 : GISTEP = 1 : GIEND = 10
840 FOR GI = GISTART TO GIEND STEP GISTEP
850 GAMMA = GI / 10
860 COMBOCOUNT = COMBOCOUNT + 1
870 PERCENTDONE = INT((COMBOCOUNT / TOTALCOMBOS) * 100)
880 FOR RST = 1 TO N
890 S(RST) = 0 : T(RST) = 0 : C(RST) = 0
900 NEXT RST
910 FOR RST = 1 TO N + H
920 F(RST) = 0 : E(RST) = 0
930 NEXT RST
940 MSE = 0
950 PRINT:PRINT "TESTING COMBINATION "; COMBOCOUNT; " OF "; TOTALCOMBOS; ""
960 PRINT "ALPHA = "; ALPHA; " BETA = "; BETA; " GAMMA = "; GAMMA 
970 PRINT PERCENTDONE; "% COMPLETE"
990 S(1) = Y(1)
1000 REM === TREND INITIALIZATION ===
1010 SUMT = 0
1020 COUNT = 0
1030 FOR J = 1 TO TRAINSIZE - 1
1040 SUMT = SUMT + (Y(J + 1) - Y(J))
1050 COUNT = COUNT + 1
1060 NEXT J
1070 IF COUNT > 0 THEN T(1) = SUMT / COUNT ELSE T(1) = 0
1080 REM TREND T(1) INITIALIZED AS AVERAGE SLOPE OVER TRAINING DATA
1090 YMEAN = 0
1100 FOR I = 1 TO TRAINSIZE
1110 YMEAN = YMEAN + Y(I)
1120 NEXT I
1130 YMEAN = YMEAN / TRAINSIZE
1140 IF MODELTYPE = 1 THEN GOTO 1170
1150 IF MODELTYPE = 2 THEN GOTO 1460
1160 GOTO 1300
1170 FOR I = 1 TO P
1180 SUMC = 0
1190 COUNT = 0
1200 FOR J = 0 TO INT((TRAINSIZE - I) / P)
1210 IDX = I + J * P
1220 IF IDX <= TRAINSIZE THEN SUMC = SUMC + (Y(IDX) - YMEAN) : COUNT = COUNT + 1
1230 NEXT J
1240 IF COUNT > 0 THEN C(I) = SUMC / COUNT ELSE C(I) = 0
1250 NEXT I
1260 REM --- EXTEND SEASONAL COMPONENT TO COVER TRAINING RANGE
1270 FOR I = P + 1 TO TRAINSIZE
1280 C(I) = C(I - P)
1290 NEXT I
1300 FOR I = P + 1 TO TRAINSIZE
1310 IF MODELTYPE = 1 THEN GOTO 1340
1320 IF MODELTYPE = 2 THEN GOTO 1390
1330 GOTO 1560
1340 REM --- ADDITIVE UPDATE ---
1350 S(I) = ALPHA * (Y(I) - C(I-P)) + (1 - ALPHA) * (S(I-1) + T(I-1))
1360 T(I) = BETA * (S(I) - S(I-1)) + (1 - BETA) * T(I-1)
1370 C(I) = GAMMA * (Y(I) - S(I)) + (1 - GAMMA) * C(I-P)
1380 GOTO 1560
1390 PRINT "*** WARNING: ZERO VALUE IN MULTIPLICATIVE UPDATE AT STEP "; I
1400 IF C(I-P) = 0 THEN C(I-P) = .0001
1410 S(I) = ALPHA * (Y(I) / C(I-P)) + (1 - ALPHA) * (S(I-1) + T(I-1))
1420 T(I) = BETA * (S(I) - S(I-1)) + (1 - BETA) * T(I-1)
1430 IF S(I) = 0 THEN S(I) = .0001
1440 C(I) = GAMMA * (Y(I) / S(I)) + (1 - GAMMA) * C(I-P)
1450 GOTO 1560
1460 FOR J = 1 TO P
1470 SUMC = 0
1480 COUNT = 0
1490 FOR K = 0 TO INT((TRAINSIZE - J) / P)
1500 IDX = J + K * P
1510 IF IDX <= TRAINSIZE AND YMEAN <> 0 THEN SUMC = SUMC + (Y(IDX) / YMEAN) : COUNT = COUNT + 1
1520 NEXT K
1530 IF COUNT > 0 THEN C(J) = SUMC / COUNT ELSE C(J) = 1
1540 NEXT J
1550 GOTO 1300
1560 NEXT I
1570 FOR K = P + 1 TO TRAINSIZE
1580 IF ABS(S(K)) > 1E+10 OR ABS(C(K)) > 1E+10 THEN PRINT "UNSTABLE FOR ALPHA="; ALPHA; " BETA="; BETA; " GAMMA="; GAMMA : GOTO 1820
1590 NEXT K
1600 REM CALCULATE FORECAST AND MSE
1610 FOR I = 1 TO H
1620 TEMP = ((TRAINSIZE + I - 1) MOD P) + 1
1630 IF MODELTYPE = 1 THEN F(TRAINSIZE+I) = S(TRAINSIZE) + I * T(TRAINSIZE) + C(TEMP)
1640 IF MODELTYPE = 2 THEN F(TRAINSIZE+I) = (S(TRAINSIZE) + I * T(TRAINSIZE)) * C(TEMP)
1650 NEXT I
1660 FOR I = 1 TO H
1670 E(I) = 0
1680 E(I) = Y(TRAINSIZE + I) - F(TRAINSIZE + I)
1690 MSE = MSE + E(I) * E(I)
1700 NEXT I
1710 MSE = MSE / H
1720 IF MSE = 0 THEN PRINT "*** WARNING: MSE=0 â€” CHECK FOR POSSIBLE MODEL DEGENERACY! ***"
1730 PRINT "MSE FOR ALPHA="; ALPHA; " BETA="; BETA; " GAMMA="; GAMMA; ": "; MSE
1740 IF MSE < BESTMSE THEN GOTO 1760
1750 GOTO 1820
1760 BESTMSE = MSE
1770 BESTALPHA = ALPHA
1780 BESTBETA = BETA
1790 BESTGAMMA = GAMMA
1800 REM END OF BEST VALUE ASSIGNMENT
1810 REM CONTINUES TO NEXT GAMMA
1820 NEXT GI
1830 NEXT BI
1840 PRINT "------------------------------------------------------------"
1850 NEXT AI
1860 PRINT "OPTIMAL ALPHA: "; BESTALPHA
1870 PRINT "OPTIMAL BETA: "; BESTBETA
1880 PRINT "OPTIMAL GAMMA: "; BESTGAMMA
1890 PRINT "BEST MEAN SQUARED ERROR: "; BESTMSE
1900 PRINT "------------------------------------------------------------"
1910 PRINT "OPTIMAL SMOOTHING FACTORS FOUND."
1920 PRINT "THE PROGRAM WILL NOW USE THESE FACTORS TO COMPUTE FORECASTS"
1930 PRINT "AND CALCULATE ERROR METRICS."
1940 PRINT:PRINT "PRESS ENTER TO CONTINUE."
1950 INPUT CONTINUE$
1960 IF CONTINUE$ = "" THEN GOTO 1970
1970 REM USE OPTIMAL SMOOTHING FACTORS
1980 ALPHA = BESTALPHA
1990 BETA = BESTBETA
2000 GAMMA = BESTGAMMA
2010 S(1) = Y(1)
2020 T(1) = 0
2030 FOR I = 1 TO P
2040 C(I) = Y(I) - S(1)
2050 NEXT I
2060 FOR I = P + 1 TO TRAINSIZE
2070 S(I) = ALPHA * (Y(I) - C(I-P)) + (1 - ALPHA) * (S(I-1) + T(I-1))
2080 T(I) = BETA * (S(I) - S(I-1)) + (1 - BETA) * T(I-1)
2090 C(I) = GAMMA * (Y(I) - S(I)) + (1 - GAMMA) * C(I-P)
2100 NEXT I
2110 FOR I = P + 1 TO TRAINSIZE
2120 TEMP = ((I - 1) MOD P) + 1
2130 IF MODELTYPE = 1 THEN F(I) = S(I - 1) + T(I - 1) + C(TEMP)
2140 IF MODELTYPE = 2 THEN F(I) = (S(I - 1) + T(I - 1)) * C(TEMP)
2150 E(I) = Y(I) - F(I)
2160 NEXT I
2170 REM FORECAST DATA
2180 FOR I = 1 TO H
2190 TEMP = ((TRAINSIZE + I - 1) MOD P) + 1
2200 IF MODELTYPE = 1 THEN F(TRAINSIZE + I) = S(TRAINSIZE) + I * T(TRAINSIZE) + C(TEMP)
2210 IF MODELTYPE = 2 THEN F(TRAINSIZE + I) = (S(TRAINSIZE) + I * T(TRAINSIZE)) * C(TEMP)
2220 NEXT I
2230 SUME2 = 0
2240 MSE = 0
2250 FOR I = 1 TO H
2260 MSE = MSE + (Y(TRAINSIZE + I) - F(TRAINSIZE + I)) ^ 2
2270 NEXT I
2280 MSE = MSE / H
2290 SE = SQR(MSE)
2300 PRINT "STANDARD ERROR USED FOR INTERVALS: "; SE
2310 REM === CALCULATE MEAN OF TRAINING DATA ===
2320 YAVG = 0
2330 FOR I = 1 TO TRAINSIZE
2340 YAVG = YAVG + Y(I)
2350 NEXT I
2360 YAVG = YAVG / TRAINSIZE
2370 REM === CALCULATE STANDARD DEVIATION OF TRAINING DATA ===
2380 SUMSQR = 0
2390 FOR I = 1 TO TRAINSIZE
2400 SUMSQR = SUMSQR + (Y(I) - YAVG) ^ 2
2410 NEXT I
2420 YSTD = SQR(SUMSQR / (TRAINSIZE - 1))
2430 REM === RELATIVE STANDARD ERROR CHECK ===
2440 IF SE / YAVG > .25 THEN PRINT "*** WARNING: FORECAST ERROR > 25% OF DATA MEAN â€” POSSIBLY UNSTABLE MODEL ***"
2450 REM === SE COMPARED TO IN-SAMPLE VOLATILITY ===
2460 IF SE > YSTD THEN PRINT "*** WARNING: FORECAST ERROR > DATA VOLATILITY â€” CHECK MODEL FIT OR P ***"
2470 REM PRINT FORECASTS WITH PREDICTION INTERVALS
2480 PRINT CHR$(7): PRINT "***********************************"
2490 PRINT "FORECASTS WITH PREDICTION INTERVALS:"
2500 FOR I = 1 TO H
2510 TEMP = ((TRAINSIZE + I - 1) MOD P) + 1
2520 IF MODELTYPE = 1 THEN F(TRAINSIZE + I) = S(TRAINSIZE) + I * T(TRAINSIZE) + C(TEMP)
2530 IF MODELTYPE = 2 THEN F(TRAINSIZE + I) = (S(TRAINSIZE) + I * T(TRAINSIZE)) * C(TEMP)
2540 U(TRAINSIZE + I) = F(TRAINSIZE + I) + 1.96 * SE * SQR(I)
2550 L(TRAINSIZE + I) = F(TRAINSIZE + I) - 1.96 * SE * SQR(I)
2560 IF L(TRAINSIZE + I) < 0 THEN L(TRAINSIZE + I) = 0
2570 PRINT "STEP"; I; " | FORECAST:"; F(TRAINSIZE + I); " | UPPER:"; U(TRAINSIZE + I); " | LOWER:"; L(TRAINSIZE + I)
2580 IF I MOD 20 = 0 THEN GOSUB 3700
2590 NEXT I
2600 PRINT "***********************************"
2610 REM PRINT FORECASTS AND ERRORS
2620 MPE = 0
2630 MAPE = 0
2640 MAE = 0
2650 RMSE = 0
2660 PAUSED = 0
2670 VALIDH = 0
2680 SUME2 = 0
2690 FOR I = 1 TO H
2700 IF Y(TRAINSIZE + I) = 0 THEN PRINT "DIVISION BY ZERO AT STEP "; I : GOTO 2780
2710 VALIDH = VALIDH + 1
2720 E(I) = (Y(TRAINSIZE + I) - F(TRAINSIZE + I)) / Y(TRAINSIZE + I)
2730 SUME2 = SUME2 + E(I) * E(I)
2740 MPE = MPE + E(I)
2750 MAPE = MAPE + ABS(E(I))
2760 MAE = MAE + ABS(Y(TRAINSIZE + I) - F(TRAINSIZE + I))
2770 RMSE = RMSE + (Y(TRAINSIZE + I) - F(TRAINSIZE + I)) ^ 2
2780 IF I MOD 20 = 0 THEN GOSUB 3700
2790 NEXT I
2800 MPE = MPE / VALIDH * 100
2810 MAPE = MAPE / VALIDH * 100
2820 PRINT "NOTE: ANY FORECAST STEPS WITH DIVISION BY ZERO WERE SKIPPED."
2830 MAE = MAE / VALIDH
2840 RMSE = SQR(RMSE / VALIDH)
2850 PRINT "MEAN PERCENTAGE ERROR: "; MPE; "%"
2860 PRINT "MEAN ABSOLUTE PERCENTAGE ERROR: "; MAPE; "%"
2870 PRINT "MEAN ABSOLUTE ERROR: "; MAE
2880 PRINT "ROOT MEAN SQUARED ERROR: "; RMSE
2890 REM DURBIN-WATSON STATISTIC
2900 DWNUMERATOR = 0
2910 DWDENOMINATOR = 0
2920 PAUSED = 0
2930 FOR I = P + 2 TO TRAINSIZE
2940 DWNUMERATOR = DWNUMERATOR + (E(I) - E(I-1)) ^ 2
2950 DWDENOMINATOR = DWDENOMINATOR + E(I) ^ 2
2960 IF I MOD 20 = 0 THEN GOSUB 3700
2970 NEXT I
2980 DURBINWATSON = DWNUMERATOR / DWDENOMINATOR
2990 PRINT "DURBIN-WATSON STATISTIC: "; DURBINWATSON
3000 REM LJUNG-BOX Q TEST
3010 Q = 0
3020 EMEAN = 0
3030 FOR I = P + 1 TO TRAINSIZE
3040 EMEAN = EMEAN + E(I)
3050 NEXT I
3060 EMEAN = EMEAN / (TRAINSIZE - P)
3070 FOR K = 1 TO 10
3080 SUMRK = 0
3090 FOR T = P + K + 1 TO TRAINSIZE
3100 SUMRK = SUMRK + (E(T) - EMEAN) * (E(T - K) - EMEAN)
3110 NEXT T
3120 RK = SUMRK / SUME2
3130 Q = Q + (RK * RK) / (TRAINSIZE - P - K)
3140 IF K MOD 10 = 0 THEN GOSUB 3700
3150 NEXT K
3160 Q = Q * (TRAINSIZE - P) * ((TRAINSIZE - P) + 2)
3170 PRINT "LJUNG-BOX Q STATISTIC: "; Q
3180 PRINT "***********************************"
3190 REM CALCULATE AUTOCORRELATION FUNCTION (ACF) FOR THE HISTORICAL DATA SERIES Y
3200 REM AUTOCORRELATION FUNCTION (ACF) CALCULATION
3210 YMEAN = 0
3220 FOR I = 1 TO N
3230 YMEAN = YMEAN + Y(I)
3240 NEXT I
3250 YMEAN = YMEAN / N
3260 FOR LAG = 1 TO 2 * P
3270 NUMERATOR = 0
3280 DENOMINATOR = 0
3290 FOR I = 1 TO N - LAG
3300 NUMERATOR = NUMERATOR + (Y(I) - YMEAN) * (Y(I + LAG) - YMEAN)
3310 NEXT I
3320 FOR I = 1 TO N
3330 DENOMINATOR = DENOMINATOR + (Y(I) - YMEAN) * (Y(I) - YMEAN)
3340 NEXT I
3350 ACFY(LAG) = NUMERATOR / DENOMINATOR
3360 PRINT "ACF FOR HISTORICAL DATA AT LAG "; LAG; ": "; ACFY(LAG)
3370 IF LAG MOD 20 = 0 THEN GOSUB 3700
3380 NEXT LAG
3390 PRINT "***********************************"
3400 REM CALCULATE AUTOCORRELATION FUNCTION (ACF) FOR RESIDUALS
3410 PRINT "CALCULATING ACF FOR RESIDUALS..."
3420 EMEAN = 0
3430 FOR I = P + 1 TO TRAINSIZE
3440 EMEAN = EMEAN + E(I)
3450 NEXT I
3460 EMEAN = EMEAN / (TRAINSIZE - P)
3470 FOR LAG = 1 TO 2 * P
3480 NUMERATOR = 0
3490 DENOMINATOR = 0
3500 FOR I = P + 1 TO TRAINSIZE - LAG
3510 NUMERATOR = NUMERATOR + (E(I) - EMEAN) * (E(I + LAG) - EMEAN)
3520 NEXT I
3530 FOR J = P + 1 TO TRAINSIZE
3540 DENOMINATOR = DENOMINATOR + (E(J) - EMEAN) * (E(J) - EMEAN)
3550 NEXT J
3560 IF DENOMINATOR = 0 THEN ACFRES(LAG) = 0 ELSE ACFRES(LAG) = NUMERATOR / DENOMINATOR
3570 PRINT "ACF FOR RESIDUALS AT LAG "; LAG; ": "; ACFRES(LAG)
3580 IF LAG MOD 20 = 0 THEN GOSUB 3700
3590 NEXT LAG
3600 REM END OF RESIDUAL ACF LOOP
3610 REM PROMPT USER TO PRINT REPORT OR EXIT
3620 PRINT "WOULD YOU LIKE TO PRINT THE REPORT OR EXIT OR RESTART?"
3630 PRINT "ENTER 'P' TO PRINT, 'E' TO EXIT, 'R' TO RESTART"
3640 INPUT CHOICE$
3650 IF CHOICE$ = "P" THEN GOSUB 4070 : GOTO 3620
3660 IF CHOICE$ = "E" THEN GOTO 4550
3670 IF CHOICE$ = "R" THEN GOTO 10
3680 PRINT "INVALID CHOICE. PLEASE ENTER 'P', 'E', OR 'R'."
3690 GOTO 3620
3700 REM SUBROUTINE FOR PAGINATION
3710 IF PAUSED = 1 THEN RETURN
3720 PRINT : PRINT "PRESS ENTER TO CONTINUE..."
3730 INPUT PAUSE$
3740 PAUSED = 1
3750 RETURN
3760 REM SUBROUTINE TO CALCULATE ACF AND DETERMINE P
3770 P = 0
3780 DIM TEMPACF(100)
3790 YMEAN = 0
3800 DIM CANDP(3), CANDVAL(3)
3810 FOR I = 1 TO N
3820 YMEAN = YMEAN + Y(I)
3830 NEXT I
3840 YMEAN = YMEAN / N
3850 FOR LAG = 1 TO 100
3860 SUMNUM = 0
3870 SUMDEN = 0
3880 FOR I = LAG + 1 TO N
3890 SUMNUM = SUMNUM + (Y(I) - YMEAN) * (Y(INT(I - LAG)) - YMEAN)
3900 NEXT I
3910 FOR I = 1 TO N
3920 SUMDEN = SUMDEN + (Y(I) - YMEAN) ^ 2
3930 NEXT I
3940 TEMPACF(LAG) = SUMNUM / SUMDEN
3950 THRESHOLD = 1.96 / SQR(N)
3960 IF TEMPACF(LAG) > CANDVAL(1) THEN CANDP(3) = CANDP(2) : CANDVAL(3) = CANDVAL(2) : CANDP(2) = CANDP(1) : CANDVAL(2) = CANDVAL(1) : CANDP(1) = LAG : CANDVAL(1) = TEMPACF(LAG)
3970 MAXACF = 0
3980 FOR LAG2 = 4 TO 99
3990 IF TEMPACF(LAG2) > THRESHOLD THEN GOTO 4010
4000 GOTO 4020
4010 IF TEMPACF(LAG2) > TEMPACF(LAG2 - 1) AND TEMPACF(LAG2) > TEMPACF(LAG2 + 1) THEN P = LAG2 : GOTO 4060
4020 NEXT LAG2
4030 IF CANDP(1) > 0 THEN P = CANDP(1)
4040 IF N < 2 * P THEN PRINT "WARNING: SEASONAL PERIOD P MAY BE TOO LARGE FOR DATA LENGTH." : REM CONTINUE ANYWAY
4050 NEXT LAG
4060 RETURN
4070 REM PRINT REPORT SUBROUTINE
4080 SE = SQR(BESTMSE)  ' USE THE FORECAST ERROR-BASED MSE
4090 REM === CALCULATE YAVG AND YSTD FOR WARNINGS ===
4100 YAVG = 0
4110 FOR I = 1 TO TRAINSIZE
4120 YAVG = YAVG + Y(I)
4130 NEXT I
4140 YAVG = YAVG / TRAINSIZE
4150 SUMSQR = 0
4160 FOR I = 1 TO TRAINSIZE
4170 SUMSQR = SUMSQR + (Y(I) - YAVG) ^ 2
4180 NEXT I
4190 YSTD = SQR(SUMSQR / (TRAINSIZE - 1))
4200 LPRINT "********** HOLT-WINTERS FORECASTING REPORT **********"
4210 IF MODELTYPE = 1 THEN LPRINT "MODEL TYPE: ADDITIVE"
4220 IF MODELTYPE = 2 THEN LPRINT "MODEL TYPE: MULTIPLICATIVE"
4230 LPRINT "SEASONAL PERIOD: "; P
4240 LPRINT "OPTIMAL ALPHA: "; BESTALPHA
4250 LPRINT "OPTIMAL BETA: "; BESTBETA
4260 LPRINT "OPTIMAL GAMMA: "; BESTGAMMA
4270 LPRINT "BEST MEAN SQUARED ERROR: "; BESTMSE
4280 LPRINT "MEAN PERCENTAGE ERROR: "; MPE; "%"
4290 LPRINT "NOTE: ERROR METRICS BASED ON HELD-OUT FORECASTS."
4300 LPRINT "      RESIDUALS USED FOR DIAGNOSTIC TESTING ONLY."
4310 LPRINT "MEAN ABSOLUTE PERCENTAGE ERROR: "; MAPE; "%"
4320 LPRINT "MEAN ABSOLUTE ERROR: "; MAE
4330 LPRINT "ROOT MEAN SQUARED ERROR: "; RMSE
4340 LPRINT "STANDARD ERROR USED FOR PREDICTION INTERVALS: "; SE
4350 IF SE / YAVG > .25 THEN LPRINT "*** WARNING: FORECAST ERROR > 25% OF DATA MEAN â€” MODEL MAY BE UNSTABLE ***"
4360 IF SE > YSTD THEN LPRINT "*** WARNING: FORECAST ERROR > DATA VOLATILITY â€” CHECK MODEL FIT OR SEASONALITY ***"
4370 LPRINT "DURBIN-WATSON STATISTIC: "; DURBINWATSON
4380 LPRINT "LJUNG-BOX Q STATISTIC: "; Q
4390 LPRINT "--------------------------------------"
4400 LPRINT "FORECASTS WITH PREDICTION INTERVALS:"
4410 FOR I = 1 TO H
4420 LPRINT "STEP "; I; " | FORECAST: "; F(TRAINSIZE + I); " | UPPER: "; U(TRAINSIZE + I); " | LOWER: "; L(TRAINSIZE + I)
4430 NEXT I
4440 LPRINT "--------------------------------------"
4450 LPRINT "AUTOCORRELATION FUNCTION (ACF) VALUES FOR HISTORICAL DATA:"
4460 FOR LAG = 1 TO 2 * P
4470 LPRINT "ACF FOR LAG "; LAG; ": "; ACFY(LAG)
4480 NEXT LAG
4490 LPRINT "AUTOCORRELATION FUNCTION (ACF) VALUES FOR RESIDUALS:"
4500 FOR LAG = 1 TO 2 * P
4510 LPRINT "ACF FOR LAG "; LAG; ": "; ACFRES(LAG)
4520 NEXT LAG
4530 LPRINT "********** END OF REPORT **********"
4540 RETURN
4550 REM END CREDITS 
4560 PRINT "******************************************************"
4570 PRINT "*                                                    *"
4580 PRINT "*          HOLT-WINTERS FORECASTING PROGRAM          *"
4590 PRINT "*                        V1.2                        *"
4600 PRINT "******************************************************"
4610 PRINT "*                                                    *"
4620 PRINT "*    WRITTEN BY CHRISTOPHER D. VAN DER KAAY, PH.D.   *"
4630 PRINT "*                                                    *"
4640 PRINT "*                        2024                        *"
4650 PRINT "*                                                    *"
4660 PRINT "******************************************************"
4670 END
4680 REM === INFORMATION MENU SUBROUTINE ===
4690 PRINT "INFORMATION MENU"
4700 PRINT "--------------------------------------------"
4710 PRINT "1. ABOUT THIS PROGRAM"
4720 PRINT "2. WHEN TO USE HOLT-WINTERS"
4730 PRINT "3. STATISTICS DETAILS"
4740 PRINT "4. RETURN TO MAIN MENU"
4750 PRINT "--------------------------------------------"
4760 PRINT
4770 INPUT "SELECT AN OPTION (1-4): "; INFO$
4780 IF INFO$ = "1" THEN GOSUB 4850 : GOTO 4680
4790 IF INFO$ = "2" THEN GOSUB 5130 : GOTO 4680
4800 IF INFO$ = "3" THEN GOSUB 5290 : GOTO 4680
4810 IF INFO$ = "4" THEN GOTO 4840
4820 PRINT "INVALID OPTION. PLEASE ENTER 1-4."
4830 GOTO 4680
4840 RETURN
4850 PRINT "ABOUT THIS PROGRAM"
4860 PRINT "--------------------------------------------"
4870 PRINT "THE HOLT-WINTERS METHOD FOR TIME SERIES"
4880 PRINT "FORECASTING IS A COMPREHENSIVE APPROACH"
4890 PRINT "TO ESTIMATING LEVEL, TREND, AND SEASONAL"
4900 PRINT "COMPONENTS. THIS PROGRAM USES OPTIMIZED"
4910 PRINT "SMOOTHING FACTORS: ALPHA (LEVEL), BETA"
4920 PRINT "(TREND), AND GAMMA (SEASONALITY) TO PROVIDE"
4930 PRINT "ACCURATE FORECASTS AND ERROR METRICS."
4940 PRINT "SUITABLE FOR DATA WITH BOTH TREND AND"
4950 PRINT "SEASONAL VARIATIONS, IT HELPS IN MAKING"
4960 PRINT "RELIABLE FUTURE PREDICTIONS."
4970 PRINT
4980 PRINT "PRESS ENTER TO RETURN."
4990 INPUT PAUSE$
5000 PRINT "ADDITIVE AND MULTIPLICATIVE SEASONALITY"
5010 PRINT "--------------------------------------------"
5020 PRINT "THIS PROGRAM SUPPORTS TWO TYPES OF SEASONALITY:"
5030 PRINT "  - ADDITIVE: SEASONAL EFFECT IS CONSTANT OVER TIME"
5040 PRINT "  - MULTIPLICATIVE: SEASONAL EFFECT GROWS OR SHRINKS"
5050 PRINT "IN THE BEGINNING, YOU WILL BE ASKED TO SELECT EITHER"
5060 PRINT "'A' FOR ADDITIVE OR 'M' FOR MULTIPLICATIVE SEASONALITY."
5070 PRINT "THIS CHOICE DETERMINES HOW FORECASTS ARE CALCULATED."
5080 PRINT "--------------------------------------------"
5090 PRINT
5100 PRINT "PRESS ENTER TO RETURN."
5110 INPUT PAUSE$
5120 RETURN
5130 PRINT "WHEN TO USE HOLT-WINTERS"
5140 PRINT "--------------------------------------------"
5150 PRINT "HOLT-WINTERS SHOULD BE USED WHEN YOUR DATA"
5160 PRINT "EXHIBITS BOTH TREND AND SEASONALITY. THIS"
5170 PRINT "METHOD IS IDEAL FOR TIME SERIES DATA WHERE"
5180 PRINT "SEASONAL PATTERNS AND TRENDS ARE EXPECTED"
5190 PRINT "TO CONTINUE. EXAMPLES INCLUDE:"
5200 PRINT " 1. MONTHLY SALES FIGURES"
5210 PRINT " 2. QUARTERLY REVENUE DATA"
5220 PRINT " 3. ANNUAL TEMPERATURE READINGS"
5230 PRINT "IT IS LESS SUITABLE FOR DATA WITHOUT CLEAR"
5240 PRINT "SEASONAL OR TREND COMPONENTS."
5250 PRINT
5260 PRINT "PRESS ENTER TO RETURN."
5270 INPUT PAUSE$
5280 RETURN
5290 PRINT "STATISTICS DETAILS"
5300 PRINT "--------------------------------------------"
5310 PRINT "MPE: MEAN PERCENTAGE ERROR"
5320 PRINT " - MEASURES AVERAGE PERCENTAGE ERROR."
5330 PRINT " - INDICATES WHETHER FORECASTS ARE"
5340 PRINT "   CONSISTENTLY TOO HIGH OR LOW."
5350 PRINT
5360 PRINT "MAPE: MEAN ABSOLUTE PERCENTAGE ERROR"
5370 PRINT " - AVERAGE OF ABSOLUTE PERCENTAGE ERRORS."
5380 PRINT " - USEFUL FOR COMPARING FORECAST ACCURACY"
5390 PRINT "   ACROSS DIFFERENT DATASETS."
5400 PRINT
5410 PRINT "PRESS ENTER FOR MORE DETAILS."
5420 INPUT PAUSE$
5430 PRINT "--------------------------------------------"
5440 PRINT "RMSE: ROOT MEAN SQUARED ERROR"
5450 PRINT " - MEASURES THE SQUARE ROOT OF THE AVERAGE"
5460 PRINT "   OF SQUARED ERRORS."
5470 PRINT " - INDICATES THE SPREAD OF FORECAST ERRORS."
5480 PRINT
5490 PRINT "MAE: MEAN ABSOLUTE ERROR"
5500 PRINT " - AVERAGE OF ABSOLUTE ERRORS."
5510 PRINT " - SHOWS THE AVERAGE MAGNITUDE OF ERRORS"
5520 PRINT "   WITHOUT CONSIDERING THEIR DIRECTION."
5530 PRINT
5540 PRINT "PRESS ENTER FOR MORE DETAILS."
5550 INPUT PAUSE$
5560 PRINT "--------------------------------------------"
5570 PRINT "DURBIN-WATSON: AUTOCORRELATION TEST"
5580 PRINT " - TESTS FOR AUTOCORRELATION IN RESIDUALS"
5590 PRINT "   FROM A REGRESSION ANALYSIS."
5600 PRINT " - VALUES CLOSE TO 2 SUGGEST NO AUTOCORREL."
5610 PRINT
5620 PRINT "LJUNG-BOX Q: AUTOCORRELATION TEST"
5630 PRINT " - TESTS FOR PRESENCE OF AUTOCORRELATION"
5640 PRINT "   IN TIME SERIES DATA."
5650 PRINT " - SIGNIFICANT Q INDICATES NON-RANDOMNESS."
5660 PRINT
5670 PRINT "PRESS ENTER TO RETURN."
5680 INPUT PAUSE$
5690 RETURN
5700 REM === DEBUG MODE SUBROUTINE ===
5710 PRINT : PRINT ">>> DEBUG MODE ENABLED - POPULATING TEST DATA <<<"
5720 MODELTYPE = 1  ' 1 FOR ADDITIVE, 2 FOR MULTIPLICATIVE
5730 N = 24
5740 H = 6
5750 TRAINSIZE = N - H
5760 DIM Y(400), F(400), S(400), T(400), C(400), U(400), L(400), E(400), ACFY(200), ACFRES(200)
5770 FOR I = 1 TO N
5780 Y(I) = 100 + 10 * SIN(2 * 3.14 * I / 12) + .5 * I  ' SIMPLE SEASONAL TREND WITH NOISE
5790 NEXT I
5800 PRINT "MODEL TYPE: ADDITIVE"
5810 PRINT "DATA POINTS LOADED: "; N
5820 PRINT "FORECAST HORIZON: "; H
5830 PRINT "DEBUG DATA LOADED SUCCESSFULLY"
5840 PRINT "NOW JUMPING TO MAIN FORECAST ROUTINE. PLEASE BE PATIENT..."
5850 RETURN
